<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ggbraid">
<title>Average Daily Temperatures • ggbraid</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Average Daily Temperatures">
<meta property="og:description" content="ggbraid">
<meta property="og:image" content="https://nsgrantham.github.io/ggbraid/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ggbraid</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/temps.html">Average Daily Temperatures</a>
    <a class="dropdown-item" href="../articles/hoops.html">NBA Finals Game</a>
    <a class="dropdown-item" href="../articles/court.html">US Supreme Court</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nsgrantham/ggbraid/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="temps_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Average Daily Temperatures</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nsgrantham/ggbraid/blob/HEAD/vignettes/temps.Rmd" class="external-link"><code>vignettes/temps.Rmd</code></a></small>
      <div class="d-none name"><code>temps.Rmd</code></div>
    </div>

    
    
<div class="alert alert-info">
<p>This article presents the “Unbraided Ribbon Problem” in which <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> incorrectly fills the area between two alternating lines with two different colors. To fix the problem, we use <code><a href="../reference/geom_braid.html">geom_braid()</a></code> from <code>ggbraid</code> with <code>method = 'line'</code>.</p>
</div>
<p>Let’s compare the temperatures of two cities in the United States: New York, New York and San Francisco, California.</p>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p><code>ggbraid</code> provides a data frame called <code>temps</code>, with daily average temperatures of New York and San Francisco in 2021 as recorded by the US National Weather Service (NWS) at <a href="https://weather.gov" class="external-link">weather.gov</a>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;It is difficult to pull data from the NWS. It does not provide the data via an API and the data it returns through its point-and-click interface isn’t in plain text format! To make matters worse, you can only retrieve data from a city one month at a time. For San Francisco, visit &lt;a href="https://www.weather.gov/wrh/climate?wfo=mtr" class="external-link"&gt;weather.gov/wrh/climate?wfo=mtr&lt;/a&gt; and choose “San Francisco City, CA”, “Daily data for a month”, and a month from 2021; for New York, visit &lt;a href="https://www.weather.gov/wrh/climate?wfo=okx" class="external-link"&gt;weather.gov/wrh/climate?wfo=okx&lt;/a&gt; and choose “NY-Central Park Area”, “Daily data for a month”, and a month from 2021. Copy and paste the data into spreadsheet software for further processing.&lt;/p&gt;'><sup>1</sup></a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nsgrantham.github.io/ggbraid">ggbraid</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">temps</span><span class="op">)</span>

<span class="va">temps</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 730 × 3</span></span>
<span class="co">#&gt;    city     date         avg</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> New York 2021-01-01  36.5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> New York 2021-01-02  43.5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> New York 2021-01-03  36  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> New York 2021-01-04  39  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> New York 2021-01-05  39  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> New York 2021-01-06  37.5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> New York 2021-01-07  35.5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> New York 2021-01-08  32  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> New York 2021-01-09  30.5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> New York 2021-01-10  35  </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 720 more rows</span></span></code></pre></div>
<p><code>city</code> is <code>New York</code> or <code>San Francisco</code>, <code>date</code> is a calendar date in the <code>YYYY-MM-DD</code> format, and <code>avg</code> is the average temperature recorded in degrees Fahrenheit (°F) and rounded to the nearest half degree.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;For those who use degrees Celsius: 0°C is 32°F, 10°C is 50°F, 20°C is 68°F, and 30°C is 86°F.&lt;/p&gt;"><sup>2</sup></a></p>
<p>What do the daily average temperatures look like?</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temps</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">avg</span>, linetype <span class="op">=</span> <span class="va">city</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="temps_files/figure-html/temps-plot-1.png" width="100%"></p>
<p>We see much higher variability in temperatures in New York compared with San Francisco. This makes sense — New York is in the Northeastern US and experiences hot, humid summers and cold, occassionally snowy winters. San Francisco is on the West Coast and its Mediterranean climate means its temperature does not change much season to season.</p>
<p>Before we proceed further, let’s clean up the plot a bit and assign it to a variable <code>p</code> so we can reuse it throughout the article.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">avg</span>, linetype <span class="op">=</span> <span class="va">city</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">temps</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%b"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
    labels <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"°F"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span>,
    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">90</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Average Daily Temperatures in 2021"</span>,
    linetype <span class="op">=</span> <span class="cn">NULL</span>,
    y <span class="op">=</span> <span class="cn">NULL</span>,
    x <span class="op">=</span> <span class="cn">NULL</span> 
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>
    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,
    plot.title.position <span class="op">=</span> <span class="st">"plot"</span>,
    legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">1.06</span><span class="op">)</span>,
    legend.direction <span class="op">=</span> <span class="st">"horizontal"</span>,
    legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"line"</span><span class="op">)</span>,
    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,
    panel.grid.major.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,
    panel.grid.major.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,
    panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    panel.grid.minor.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">p</span></code></pre></div>
<p><img src="temps_files/figure-html/temps-plot-polished-1.png" width="100%"></p>
<p>Much better.</p>
</div>
<div class="section level2">
<h2 id="fun-with-ribbons">Fun with Ribbons<a class="anchor" aria-label="anchor" href="#fun-with-ribbons"></a>
</h2>
<p>Let’s fill the area between the two lines. We can do so with <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> from <code>ggplot2</code>.</p>
<p><code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> requires three aesthetics: <code>x</code>, <code>ymin</code>, and <code>ymax</code>. We can map <code>date</code> to <code>x</code> as we did in <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line()</a></code>. However, we’ll need to transform <code>temps</code> to create new variables that we can map to <code>ymin</code> and <code>ymax</code>.</p>
<p>We can pivot <code>temps</code> with <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider()</a></code> from the <code>tidyr</code> package, taking column names from <code>city</code> and values from <code>avg</code>. Call the new data frame <code>temps_wide</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temps_wide</span> <span class="op">&lt;-</span> <span class="va">temps</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">city</span>, values_from <span class="op">=</span> <span class="va">avg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>ny <span class="op">=</span> <span class="va">`New York`</span>, sf <span class="op">=</span> <span class="va">`San Francisco`</span><span class="op">)</span>

<span class="va">temps_wide</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 365 × 3</span></span>
<span class="co">#&gt;    date          ny    sf</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2021-01-01  36.5  51.5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2021-01-02  43.5  50  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2021-01-03  36    50.5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2021-01-04  39    54.5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2021-01-05  39    50  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2021-01-06  37.5  50.5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2021-01-07  35.5  53  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2021-01-08  32    52.5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2021-01-09  30.5  52  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2021-01-10  35    50.5</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 355 more rows</span></span></code></pre></div>
<p>Now we can add a new layer to <code>p</code> with <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> using <code>temps_wide</code>. Map <code>date</code> to <code>x</code>, <code>ny</code> to <code>ymin</code>, and <code>sf</code> to <code>ymax</code>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Why not the other way around, with &lt;code&gt;sf&lt;/code&gt; to &lt;code&gt;ymin&lt;/code&gt; and &lt;code&gt;ny&lt;/code&gt; to &lt;code&gt;ymax&lt;/code&gt;? That’s fine too because the lines alternate over/under one another.&lt;/p&gt;"><sup>3</sup></a> Finally, add some transparency with <code>alpha = 0.3</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, ymin <span class="op">=</span> <span class="va">ny</span>, ymax <span class="op">=</span> <span class="va">sf</span><span class="op">)</span>,
    data <span class="op">=</span> <span class="va">temps_wide</span>,
    alpha <span class="op">=</span> <span class="fl">0.3</span>
  <span class="op">)</span></code></pre></div>
<p><img src="temps_files/figure-html/geom-ribbon-without-fill-1.png" width="100%"></p>
<p>Great! Using <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> we’ve added a light grey ribbon that runs between the two lines.</p>
<p>On second thought… what if we used two colors for the ribbon? We could have one color when New York is hotter than San Francisco and another color when New York is colder than San Francisco.</p>
<p>This shouldn’t be hard to do. Map <code>sf &gt; ny</code> to <code>fill</code> in <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> and…</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, ymin <span class="op">=</span> <span class="va">ny</span>, ymax <span class="op">=</span> <span class="va">sf</span>, fill <span class="op">=</span> <span class="va">sf</span> <span class="op">&gt;</span> <span class="va">ny</span><span class="op">)</span>,
    data <span class="op">=</span> <span class="va">temps_wide</span>,
    alpha <span class="op">=</span> <span class="fl">0.7</span>
  <span class="op">)</span></code></pre></div>
<p><img src="temps_files/figure-html/geom-ribbon-with-fill-1.png" width="100%"></p>
<p>Chaos. What happened?</p>
</div>
<div class="section level2">
<h2 id="the-unbraided-ribbon-problem">The Unbraided Ribbon Problem<a class="anchor" aria-label="anchor" href="#the-unbraided-ribbon-problem"></a>
</h2>
<p>Is this a bug in <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code>?</p>
<p>No, it’s not a bug. The problem is that <strong>we haven’t dealt with line intersections properly.</strong></p>
<p>For example, consider rows 80-82 from <code>temps_wide</code>:</p>
<table class="table">
<thead><tr class="header">
<th>date</th>
<th>ny</th>
<th>sf</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>2021-03-21</td>
<td>52.5</td>
<td>52.0</td>
</tr>
<tr class="even">
<td>2021-03-22</td>
<td>52.0</td>
<td>52.0</td>
</tr>
<tr class="odd">
<td>2021-03-23</td>
<td>54.5</td>
<td>56.5</td>
</tr>
</tbody>
</table>
<p>After we have pass <code>temps_wide</code> to <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> and map <code>date</code> to <code>x</code>, <code>ny</code> to <code>ymin</code>, <code>sf</code> to <code>ymax</code>, and <code>sf &gt; ny</code> to <code>fill</code>, we get the following:</p>
<table class="table">
<thead><tr class="header">
<th>x</th>
<th>ymin</th>
<th>ymax</th>
<th>fill</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>18707</td>
<td>52.5</td>
<td>52.0</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>18708</td>
<td>52.0</td>
<td>52.0</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td>18709</td>
<td>54.5</td>
<td>56.5</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
<p>(<code>x</code> is the integer representation of <code>date</code>, the number of days since January 1, 1970, the “Unix epoch”)</p>
<p>Ok, note the middle row. <code>ymin</code> and <code>ymax</code> are equal here, so this is a point where the two lines intersect. It turns out that <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> requires two rows for every line intersection, one row where <code>fill</code> is <code>FALSE</code> and another row where <code>fill</code> is <code>TRUE</code>.</p>
<p>So we must insert a new row in the data, yielding the following:</p>
<table class="table">
<thead><tr class="header">
<th>x</th>
<th>ymin</th>
<th>ymax</th>
<th>fill</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>18707</td>
<td>52.5</td>
<td>52.0</td>
<td>FALSE</td>
</tr>
<tr class="even">
<td>18708</td>
<td>52.0</td>
<td>52.0</td>
<td>FALSE</td>
</tr>
<tr class="odd">
<td><strong>18708</strong></td>
<td><strong>52.0</strong></td>
<td><strong>52.0</strong></td>
<td><strong>TRUE</strong></td>
</tr>
<tr class="even">
<td>18709</td>
<td>54.5</td>
<td>56.5</td>
<td>TRUE</td>
</tr>
</tbody>
</table>
<p>We call this process <em>braiding</em>.</p>
<p><strong>We need to braid the ribbon where the lines intersect.</strong></p>
<p>And the intersection described here is not the only type that requires braiding.</p>
<p>There are instances where the two lines intersect <em>between</em> two rows in the data. In these cases, we must use a mathematical formula to determine the exact point at which the lines intersect and braid the ribbon accordingly. There are also instances where both lines are vertical at the same <code>x</code>, an uncommon situation but one that produces an infinite number of intersection points and requires braiding to fix.</p>
</div>
<div class="section level2">
<h2 id="braiding-with-ggbraid">Braiding with ggbraid<a class="anchor" aria-label="anchor" href="#braiding-with-ggbraid"></a>
</h2>
<p>The functions in <code>ggbraid</code> take care of all the braiding for you. Simply replace <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> with <code><a href="../reference/geom_braid.html">geom_braid()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_braid.html">geom_braid</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, ymin <span class="op">=</span> <span class="va">ny</span>, ymax <span class="op">=</span> <span class="va">sf</span>, fill <span class="op">=</span> <span class="va">sf</span> <span class="op">&gt;</span> <span class="va">ny</span><span class="op">)</span>,
    data <span class="op">=</span> <span class="va">temps_wide</span>,
    alpha <span class="op">=</span> <span class="fl">0.7</span>
  <span class="op">)</span>
<span class="co">#&gt; `geom_braid()` using method = 'line'</span></code></pre></div>
<div class="alert alert-info">
<p>#&gt; Warning in is.na(fill) &amp;&amp; !is.na(braid): ‘length(x) = 3 &gt; 1’ in coercion to #&gt; ‘logical(1)’</p>
</div>
<p><img src="temps_files/figure-html/geom-braid-with-fill-1.png" width="100%"></p>
<p>There we go!</p>
<p>Notice the message from <code><a href="../reference/geom_braid.html">geom_braid()</a></code> that it is using <code>method = 'line'</code>. Since we’ve drawn lines with <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line()</a></code> we must use <code>method = 'line'</code> to determine the point at which the lines intersect when the intersection occurs between two rows in the data. We can silence this message by explicity including <code>method = 'line'</code> within <code><a href="../reference/geom_braid.html">geom_braid()</a></code>.</p>
<p><code><a href="../reference/geom_braid.html">geom_braid()</a></code> isn’t a new geometry. It takes the data provided, performs the necessary braiding operations on it, and passes the result to <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> for drawing. If we’d like, we can still use <code><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon()</a></code> and set <code>stat = 'braid'</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, ymin <span class="op">=</span> <span class="va">ny</span>, ymax <span class="op">=</span> <span class="va">sf</span>, fill <span class="op">=</span> <span class="va">sf</span> <span class="op">&gt;</span> <span class="va">ny</span><span class="op">)</span>,
    data <span class="op">=</span> <span class="va">temps_wide</span>,
    stat <span class="op">=</span> <span class="st">"braid"</span>,
    method <span class="op">=</span> <span class="st">"line"</span>,
    alpha <span class="op">=</span> <span class="fl">0.7</span>
  <span class="op">)</span></code></pre></div>
<div class="alert alert-info">
<p>#&gt; Warning in is.na(fill) &amp;&amp; !is.na(braid): ‘length(x) = 3 &gt; 1’ in coercion to #&gt; ‘logical(1)’</p>
</div>
<p><img src="temps_files/figure-html/geom-ribbon-stat-braid-with-fill-1.png" width="100%"></p>
<p>This is the same plot as before. We’ve also silenced the message by including <code>method = 'line'</code>.</p>
<p>Finally, it may be helpful to label the ribbon colors so it’s clear what they represent. This can happen in a legend (which we’ve turned off with the <code>guides(fill = "none")</code> layer in <code>p</code>). Another possibility is to provide text annotations on the plot.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hues</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/hue_pal.html" class="external-link">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>  <span class="co"># ggplot2 default color palette</span>

<span class="va">p</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_braid.html">geom_braid</a></span><span class="op">(</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, ymin <span class="op">=</span> <span class="va">ny</span>, ymax <span class="op">=</span> <span class="va">sf</span>, fill <span class="op">=</span> <span class="va">sf</span> <span class="op">&gt;</span> <span class="va">ny</span><span class="op">)</span>,
    data <span class="op">=</span> <span class="va">temps_wide</span>,
    method <span class="op">=</span> <span class="st">"line"</span>,
    alpha <span class="op">=</span> <span class="fl">0.7</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-09-10"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">84</span>, size <span class="op">=</span> <span class="fl">4</span>, label <span class="op">=</span> <span class="st">"NY hotter than SF"</span>, hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="va">hues</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-02-20"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">23</span>, size <span class="op">=</span> <span class="fl">4</span>, label <span class="op">=</span> <span class="st">"NY colder than SF"</span>, hjust <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="va">hues</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="alert alert-info">
<p>#&gt; Warning in is.na(fill) &amp;&amp; !is.na(braid): ‘length(x) = 3 &gt; 1’ in coercion to #&gt; ‘logical(1)’</p>
</div>
<p><img src="temps_files/figure-html/geom-braid-with-fill-and-labels-1.png" width="100%"></p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://nsgrantham.com" class="external-link">Neal Grantham</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
